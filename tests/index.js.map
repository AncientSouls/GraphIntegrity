{"version":3,"sources":["../src/tests/index.js"],"names":["require","install","describe","generateGraphSpreading","NamedGraph","collection","fields","config","arguments","name","index","link","ExistedGraph","NonExistedGraph","ExistedPathGraph","NonExistedPathGraph","ExistedSpreadGraph","CustomExistedSpreadGraph","prevSpreadLink","pathGraph","pathLink","newSpreadLink","context","callback","fetch","id","undefined","error","pathLinks","source","target","prev","path","root","spreadLinks","length","NonExistedSpreadGraph","removed","launched","process","fromFields","toFields","spreadGraph","constantField","variableField","graphSpreading","addPathGraph","QueueSpreading","splited","split","Error","queueSpreading","spreader","ExistedSpreaderGraph","NonExistedSpreaderGraph","spreaderGraph"],"mappings":"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","file":"index.js","sourcesContent":["require('source-map-support').install();\n\nimport { assert } from 'chai';\n\nimport { Graph } from 'ancient-graph/lib/adapters/object.js';\n\nimport { factoryPathGraph, factorySpreadGraph, factorySpreaderGraph, GraphSpreading, QueueSpreading as AncientQueueSpreading } from '../';\nimport { factoryExistedGraph, factoryNonExistedGraph } from 'ancient-graph-removed';\n\nimport testGraphSpreading from './testSpreading.js';\nimport testQueue from './testQueue.js';\nimport testSpreader from './testSpreader.js';\n\ndescribe('AncientSouls/GraphSpreading', function() {\n  function generateGraphSpreading() {\n    \n    // Unique id between graphs\n\n    class NamedGraph extends Graph {\n      constructor(collection, fields, config) {\n        super(...arguments);\n        \n        if (config.name) this.name = config.name;\n      }\n      _idGenerator(index, link) { return this.name+'/'+index; }\n    }\n    \n    // Removed (Existed and NonExisted)\n    \n    var ExistedGraph = factoryExistedGraph(NamedGraph);\n    var NonExistedGraph = factoryNonExistedGraph(NamedGraph);\n    \n    // PathGraph\n    \n    var ExistedPathGraph = factoryPathGraph(ExistedGraph);\n    var NonExistedPathGraph = NonExistedGraph;\n    \n    // SpreadGraph\n    \n    var ExistedSpreadGraph = (() => {\n      var ExistedSpreadGraph = factorySpreadGraph(ExistedGraph);\n      class CustomExistedSpreadGraph extends ExistedSpreadGraph {\n        _spreadingHandler(prevSpreadLink, pathGraph, pathLink, newSpreadLink, context, callback) {\n          if (!pathLink) {\n            callback(newSpreadLink);\n          } else {\n            pathGraph.fetch(pathLink.id, undefined, (error, pathLinks) => {\n              this.fetch({\n                source: newSpreadLink.source, target: newSpreadLink.target,\n                prev: newSpreadLink.prev, path: newSpreadLink.path, root: newSpreadLink.root\n              }, undefined, (error, spreadLinks) => {\n                callback(!spreadLinks.length&&pathLinks.length?newSpreadLink:undefined);\n              });\n            });\n          }\n        }\n      }\n      return CustomExistedSpreadGraph;\n    })();\n    var NonExistedSpreadGraph = factorySpreadGraph(NonExistedGraph);\n    \n    // Graphs instances\n    \n    // pathGraph\n    \n    var pathGraph = new ExistedPathGraph([], {\n        id: 'id', source: 'source', target: 'target',\n        removed: 'removed', launched: 'launched', process: 'process'\n    }, { name: 'path', fromFields: ['source'], toFields: ['target'] });\n    \n    pathGraph.removed = new NonExistedPathGraph(\n      pathGraph.collection, pathGraph.fields, pathGraph.config\n    );\n    \n    // spreadGraph\n    \n    var spreadGraph = new ExistedSpreadGraph([], {\n      id: 'id', source: 'source', target: 'target',\n      removed: 'removed', launched: 'launched', process: 'process',\n      prev: 'prev', path: 'path', root: 'root'\n    }, { name: 'spread', constantField: 'source', variableField: 'target' });\n    \n    spreadGraph.removed = new NonExistedSpreadGraph(\n      spreadGraph.collection, spreadGraph.fields, spreadGraph.config\n    );\n    \n    // GraphSpreading instance\n    \n    var graphSpreading = new GraphSpreading(spreadGraph);\n    graphSpreading.addPathGraph(pathGraph);\n    \n    // QueueSpreading id parser\n    \n    class QueueSpreading extends AncientQueueSpreading {\n      _getGraph(id) {\n        var splited = id.split('/');\n        if (splited[0] == 'spread') return spreadGraph;\n        else if (splited[0] == 'path') return pathGraph;\n        else throw new Error('Graph is not founded');\n      }\n    }\n    \n    var queueSpreading = new QueueSpreading(graphSpreading);\n    \n    return { pathGraph, spreadGraph, graphSpreading, queueSpreading };\n  };\n  \n  describe('GraphSpreading PathGraph SpreadGraph', function() {\n    testGraphSpreading(generateGraphSpreading, \"abcdefghijklmnopqrstuvwxyz\".split(\"\"));\n  });\n  \n  describe('QueueSpreading PathGraph SpreadGraph', function() {\n    testQueue(generateGraphSpreading, \"abcdefghijklmnopqrstuvwxyz\".split(\"\"));\n  });\n  \n  describe('SpreaderGraph PathGraph SpreadGraph', function() {\n    testSpreader(function() {\n      \n      // Unique id between graphs\n  \n      class NamedGraph extends Graph {\n        constructor(collection, fields, config) {\n          super(...arguments);\n          \n          if (config.name) this.name = config.name;\n        }\n        _idGenerator(index, link) { return this.name+'/'+index; }\n      }\n      \n      // Removed (Existed and NonExisted)\n      \n      var ExistedGraph = factoryExistedGraph(NamedGraph);\n      var NonExistedGraph = factoryNonExistedGraph(NamedGraph);\n      \n      // PathGraph\n      \n      var ExistedPathGraph = factoryPathGraph(ExistedGraph);\n      var NonExistedPathGraph = NonExistedGraph;\n      \n      // SpreadGraph\n      \n      var ExistedSpreadGraph = (() => {\n        var ExistedSpreadGraph = factorySpreadGraph(ExistedGraph);\n        class CustomExistedSpreadGraph extends ExistedSpreadGraph {\n          _spreadingHandler(prevSpreadLink, pathGraph, pathLink, newSpreadLink, context, callback) {\n            \n            // Spreader support for this SpreadGraph\n            if (prevSpreadLink && prevSpreadLink.spreader) {\n              newSpreadLink.spreader = prevSpreadLink.spreader;\n            }\n            \n            this.fetch({\n              source: newSpreadLink.source, target: newSpreadLink.target,\n              spreader: newSpreadLink.spreader\n            }, undefined, (error, spreadLinks) => {\n              callback((!spreadLinks.length)?newSpreadLink:undefined);\n            });\n          }\n        }\n        return CustomExistedSpreadGraph;\n      })();\n      var NonExistedSpreadGraph = factorySpreadGraph(NonExistedGraph);\n      \n      // SpreaderGraph\n      \n      var ExistedSpreaderGraph = factorySpreaderGraph(ExistedGraph);\n      var NonExistedSpreaderGraph = NonExistedGraph;\n      \n      // Graphs instances\n      \n      // pathGraph\n      \n      var pathGraph = new ExistedPathGraph([], {\n          id: 'id', source: 'source', target: 'target',\n          removed: 'removed', launched: 'launched', process: 'process'\n      }, { name: 'path', fromFields: ['source'], toFields: ['target'] });\n      \n      pathGraph.removed = new NonExistedPathGraph(\n        pathGraph.collection, pathGraph.fields, pathGraph.config\n      );\n      \n      // spreadGraph\n      \n      var spreadGraph = new ExistedSpreadGraph([], {\n        id: 'id', source: 'source', target: 'target',\n        removed: 'removed', launched: 'launched', process: 'process', spreader: 'spreader',\n        prev: 'prev', path: 'path', root: 'root'\n      }, { name: 'spread', constantField: 'source', variableField: 'target' });\n      \n      spreadGraph.removed = new NonExistedSpreadGraph(\n        spreadGraph.collection, spreadGraph.fields, spreadGraph.config\n      );\n      \n      // spreaderGraph\n      \n      var spreaderGraph = new ExistedSpreaderGraph([], {\n          id: 'id', source: 'source', target: 'target',\n          removed: 'removed', launched: 'launched', process: 'process'\n      }, { name: 'spreader', constantField: 'source', variableField: 'target' });\n      \n      spreaderGraph.removed = new NonExistedSpreaderGraph(\n        spreaderGraph.collection, spreaderGraph.fields, spreaderGraph.config\n      );\n      \n      // GraphSpreading instance\n      \n      var graphSpreading = new GraphSpreading(spreadGraph);\n      graphSpreading.addPathGraph(pathGraph);\n      \n      // QueueSpreading id parser\n      \n      class QueueSpreading extends AncientQueueSpreading {\n        _getGraph(id) {\n          var splited = id.split('/');\n          if (splited[0] == 'spread') return spreadGraph;\n          else if (splited[0] == 'path') return pathGraph;\n          else if (splited[0] == 'spreader') return spreaderGraph;\n          else throw new Error('Graph is not founded');\n        }\n      }\n      \n      var queueSpreading = new QueueSpreading(graphSpreading);\n      \n      return { pathGraph, spreadGraph, spreaderGraph, graphSpreading, queueSpreading };\n    }, \"abcdefghijklmnopqrstuvwxyz\".split(\"\"));\n  });\n});"]}