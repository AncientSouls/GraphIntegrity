{"version":3,"sources":["../src/lib/spreading.js"],"names":["GraphSpreading","spreadGraph","pathGraphs","coll","iteratee","callback","each","pathGraph","push","fromField","pathLink","context","handler","fetch","variableField","undefined","error","spreadLinks","length","spreadLink","next","spreadFromSpreadLinkByPathLink","fromFields","_spreadByPathLink","newSpreadLink","_spreadingHandler","insert","spreadFromSpreadLinkByPathGraph","pathLinks","_spreadFromSpreadLinkByPathGraph","toField","constantField","id","root","toFields","_spreadFromSpreadLinkByPathLink","prev","spreadLinkId","remove","count","pathLinkId","path","_unspreadingHandler","permission","nextPathGraph","nextToField","nextPathLink","spreadByPathLink"],"mappings":"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","file":"spreading.js","sourcesContent":["import async from 'async';\n\n/**\n * Class with methods for spread and unspread of the spreadGraph on pathGraph(s).\n * \n * @class\n * @description `import { GraphSpreading } from 'ancient-graph-spreading';`\n */\nclass GraphSpreading {\n  \n  /**\n   * @param {SpreadGraph} spreadGraph\n   */\n  constructor(spreadGraph) {\n    this.spreadGraph = spreadGraph;\n    this.pathGraphs = [];\n  }\n  \n  /**\n   * Custom async callbacks support\n   * \n   * @param {Array|Iterable|Object} coll - A collection to iterate over.\n   * @param {function} iteratee - A function to apply to each item in coll.\n   * @param {function} callback - A callback which is called when all iteratee functions have finished.\n   */\n  each(coll, iteratee, callback) {\n    async.each(coll, iteratee, callback);\n  }\n  \n  /**\n   * @param {PathGraph} pathGraph\n   */\n  addPathGraph(pathGraph) {\n    this.pathGraphs.push(pathGraph);\n  }\n  \n  /**\n   * Spread by pathLink and specified fromField with available spreadLinks.\n   * \n   * @oaram {string} fromField\n   * @param {PathGraph} pathGraph\n   * @param {PathLink} pathLink\n   * @param {Object} [context]\n   * @param {GraphSpreading~spreadFromSpreadLinkByPathLinkCallback} [handler]\n   * @param {GraphSpreading~spreadByPathLinkCallback} [callback]\n   */\n  _spreadByPathLink(fromField, pathGraph, pathLink, context, handler, callback) {\n    this.spreadGraph.fetch({\n      [this.spreadGraph.variableField]: pathLink[fromField]\n    }, undefined, (error, spreadLinks) => {\n      if (spreadLinks.length) {\n        this.each(spreadLinks, (spreadLink, next) => {\n          this.spreadFromSpreadLinkByPathLink(spreadLink, pathGraph, pathLink, context, handler, () => { next(); });\n        }, () => {\n          if (callback) callback();\n        });\n      } else {\n        if (callback) callback();\n      }\n    });\n  }\n  \n  /**\n   * Spread by pathLink with available spreadLinks.\n   * \n   * @param {PathGraph} pathGraph\n   * @param {PathLink} pathLink\n   * @param {Object} [context]\n   * @param {GraphSpreading~spreadFromSpreadLinkByPathLinkCallback} [handler]\n   * @param {GraphSpreading~spreadByPathLinkCallback} [callback]\n   */\n  spreadByPathLink(pathGraph, pathLink, context, handler, callback) {\n    this.each(pathGraph.fromFields, (fromField, next) => {\n      this._spreadByPathLink(fromField, pathGraph, pathLink, context, handler, next);\n    }, callback);\n  }\n  \n  /**\n   * Optional callback.\n   *\n   * @callback GraphSpreading~spreadByPathLinkCallback\n   */\n  \n  /**\n   * Spread root of tree spreadLink.\n   * \n   * @param {SpreadLink} newSpreadLink\n   * @param {Object} [context]\n   * @param {Graph~insertCallback} [callback]\n   */\n  spreadNewSpreadLink(newSpreadLink, context, callback) {\n    this.spreadGraph._spreadingHandler(undefined, undefined, undefined, newSpreadLink, context, (newSpreadLink) => {\n      if (newSpreadLink) {\n        this.spreadGraph.insert(newSpreadLink, callback, context);\n      } else {\n        if (callback) callback();\n      }\n    });\n  }\n  \n  /**\n   * Spread by all available paths from spreadLink.\n   * \n   * @param {SpreadLink} spreadLink\n   * @param {Object} [context]\n   * @param {GraphSpreading~spreadFromSpreadLinkByPathGraphHandler} [handler]\n   * @param {GraphSpreading~spreadFromSpreadLinkByPathGraphCallback} [callback]\n   */\n  spreadFromSpreadLink(spreadLink, context, handler, callback) {\n    this.each(this.pathGraphs, (pathGraph, next) => {\n      this.spreadFromSpreadLinkByPathGraph(spreadLink, pathGraph, context, handler, next);\n    }, () => {\n      if (callback) callback();\n    });\n  }\n  \n  /**\n   * Spread by all available paths in pathGraph from spreadLink and specified fromField.\n   * \n   * @param {string} fromField\n   * @param {SpreadLink} spreadLink\n   * @param {PathGraph} pathGraph\n   * @param {GraphSpreading~spreadFromSpreadLinkByPathGraphHandler} [handler]\n   * @param {GraphSpreading~spreadFromSpreadLinkByPathGraphCallback} [callback]\n   */\n  _spreadFromSpreadLinkByPathGraph(fromField, spreadLink, pathGraph, context, handler, callback) {\n    pathGraph.fetch({\n      [fromField]: spreadLink[this.spreadGraph.variableField]\n    }, undefined, (error, pathLinks) => {\n      this.each(pathLinks, (pathLink, next) => {\n        this.spreadFromSpreadLinkByPathLink(spreadLink, pathGraph, pathLink, context, handler, next);\n      }, () => {\n        if (callback) callback();\n      });\n    });\n  }\n  \n  /**\n   * Spread by all available paths in pathGraph from spreadLink.\n   * \n   * @param {SpreadLink} spreadLink\n   * @param {PathGraph} pathGraph\n   * @param {GraphSpreading~spreadFromSpreadLinkByPathGraphHandler} [handler]\n   * @param {GraphSpreading~spreadFromSpreadLinkByPathGraphCallback} [callback]\n   */\n  spreadFromSpreadLinkByPathGraph(spreadLink, pathGraph, context, handler, callback) {\n    this.each(pathGraph.fromFields, (fromField, next) => {\n      this._spreadFromSpreadLinkByPathGraph(fromField, spreadLink, pathGraph, context, handler, next);\n    }, callback);\n  }\n  \n  /**\n   * Optional handler. If present, called with an error object as the first argument and, if no error, others arguments with results of spreading.\n   *\n   * @callback GraphSpreading~spreadFromSpreadLinkByPathGraphHandler\n   * @param {Error} [error]\n   * @param {string} [newSpreadLinkId]\n   * @param {SpreadLink} [prevSpreadLink]\n   * @param {PathGraph} [pathGraph]\n   * @param {PathLink} [pathLink]\n   */\n  \n  /**\n   * Optional callback.\n   *\n   * @callback GraphSpreading~spreadFromSpreadLinkByPathGraphCallback\n   */\n  \n  /**\n   * Spread by pathLink and specified toField in pathGraph from spreadLink.\n   * \n   * @param {SpreadLink} spreadLink\n   * @param {PathGraph} pathGraph\n   * @param {PathLink} pathLink\n   * @param {Object} [context]\n   * @param {GraphSpreading~spreadFromSpreadLinkByPathLinkCallback} [callback]\n   */\n  _spreadFromSpreadLinkByPathLink(toField, spreadLink, pathGraph, pathLink, context, callback) {\n    this.spreadGraph._spreadingHandler(spreadLink, pathGraph, pathLink, {\n      [this.spreadGraph.constantField]: spreadLink[this.spreadGraph.constantField],\n      [this.spreadGraph.variableField]: pathLink[toField],\n      prev: spreadLink.id,\n      path: pathLink.id,\n      root: spreadLink.root?spreadLink.root:spreadLink.id\n    }, context, (newSpreadLink) => {\n      if (newSpreadLink) {\n        this.spreadGraph.insert(newSpreadLink, (error, id) => {\n          if (callback) callback(error, id, spreadLink, pathGraph, pathLink);\n        }, context);\n      } else {\n        if (callback) callback();\n      }\n    });\n  }\n  \n  /**\n   * Spread by pathLink in pathGraph from spreadLink.\n   * \n   * @param {SpreadLink} spreadLink\n   * @param {PathGraph} pathGraph\n   * @param {PathLink} pathLink\n   * @param {Object} [context]\n   * @param {GraphSpreading~spreadFromSpreadLinkByPathLinkHandler} [handler]\n   * @param {GraphSpreading~spreadFromSpreadLinkByPathLinkCallback} [callback]\n   */\n  spreadFromSpreadLinkByPathLink(spreadLink, pathGraph, pathLink, context, handler, callback) {\n    this.each(pathGraph.toFields, (toField, next) => {\n      this._spreadFromSpreadLinkByPathLink(toField, spreadLink, pathGraph, pathLink, context, (error, id, prev, pathGraph, pathLink) => {\n        if (handler) handler(error, id, prev, pathGraph, pathLink);\n        next();\n      });\n    }, callback);\n  }\n  \n  /**\n   * Optional handler.\n   *\n   * @callback GraphSpreading~spreadFromSpreadLinkByPathLinkCallback\n   * @param {Error} [error]\n   * @param {string} [newSpreadLinkId]\n   * @param {SpreadLink} [prevSpreadLink]\n   * @param {PathGraph} [pathGraph]\n   * @param {PathLink} [pathLink]\n   */\n  \n  /**\n   * Optional callback. If present, called with an error object as the first argument and, if no error, the unique id of inserted spread link as the second.\n   *\n   * @callback GraphSpreading~spreadFromSpreadLinkByPathLinkCallback\n   */\n  \n  /**\n   * Remove spreadLinks with specific prev spreadLink id.\n   * \n   * @param {string} spreadLinkId\n   * @param {Object} [context]\n   * @param {GraphSpreading~unspreadFromRemovedSpreadLinkByPrevIdHandler} [handler]\n   * @param {GraphSpreading~unspreadFromRemovedSpreadLinkByPrevIdCallback} [callback]\n   */\n  unspreadFromRemovedSpreadLinkByPrevId(spreadLinkId, context, handler, callback) {\n    if (handler) {\n      this.spreadGraph.fetch({ prev: spreadLinkId }, undefined, (error, spreadLinks) => {\n        if (error) {\n          if (callback) callback(error);\n        } else {\n          this.each(spreadLinks, (spreadLink, next) => {\n            this.spreadGraph.remove(spreadLink.id, (error, count) => {\n              handler(error, spreadLink);\n              next();\n            }, context);\n          }, () => {\n            if (callback) callback(undefined, spreadLinks.length);\n          });\n        }\n      });\n    } else {\n      this.spreadGraph.remove({ prev: spreadLinkId }, callback, context);\n    }\n  }\n  \n  /**\n   * Optional handler. If present, called with an error object as the first argument and, if no error, others arguments with results of unspreading.\n   *\n   * @callback GraphSpreading~unspreadFromRemovedSpreadLinkByPrevIdHandler\n   * @param {Error} [error]\n   * @param {SpreadLink} [spreadLink]\n   */\n  \n  /**\n   * Optional callback.\n   *\n   * @callback GraphSpreading~unspreadFromRemovedSpreadLinkByPrevIdCallback\n   * @param {Error} [error]\n   * @param {number} [count]\n   */\n  \n  /**\n   * Remove spreadLinks with specific path pathLink id.\n   * \n   * @param {string} pathLinkId\n   * @param {Object} [context]\n   * @param {GraphSpreading~unspreadByPathIdHandler} [handler]\n   * @param {GraphSpreading~unspreadByPathIdCallback} [callback]\n   */\n  unspreadByPathId(pathLinkId, context, handler, callback) {\n    if (handler) {\n      this.spreadGraph.fetch({ path: pathLinkId }, undefined, (error, spreadLinks) => {\n        if (error) {\n          if (callback) callback(error);\n        } else {\n          this.each(spreadLinks, (spreadLink, next) => {\n            this.spreadGraph.remove(spreadLink.id, (error, count) => {\n              handler(error, spreadLink);\n              next();\n            }, context);\n          }, () => {\n            if (callback) callback(undefined, spreadLinks.length);\n          });\n        }\n      });\n    } else {\n      this.spreadGraph.remove({ path: pathLinkId }, callback, context);\n    }\n  }\n  \n  /**\n   * Optional handler.\n   *\n   * @callback GraphSpreading~unspreadByPathIdHandler\n   * @param {Error} [error]\n   * @param {SpreadLink} [spreadLink]\n   */\n  \n  /**\n   * Optional callback.\n   *\n   * @callback GraphSpreading~unspreadByPathIdCallback\n   * @param {Error} [error]\n   * @param {number} [count]\n   */\n  \n  /**\n   * Unspread all valid spreadLinks to this id.\n   * \n   * @param {string} id\n   * @param {Object} [context]\n   * @param {GraphSpreading~unspreadToHandler} [handler]\n   * @param {GraphSpreading~unspreadToCallback} [callback]\n   */\n  unspread(id, context, handler, callback) {\n     this.spreadGraph.fetch({ [this.spreadGraph.variableField]: id }, undefined, (error, spreadLinks) => {\n       if (error) {\n         if (callback) callback(error);\n       } else {\n          this.each(spreadLinks, (spreadLink, next) => {\n           this.spreadGraph._unspreadingHandler(spreadLink, context, (permission) => {\n             if (permission) {\n               this.spreadGraph.remove(spreadLink.id, (error, count) => {\n                 if (handler) handler(error, spreadLink);\n                 next();\n               }, context);\n             }\n           });\n          }, () => {\n            if (callback) callback(undefined, spreadLinks.length);\n          });\n       }\n     });\n  }\n  \n  /**\n   * Optional handler.\n   *\n   * @callback GraphSpreading~unspreadToHandler\n   * @param {Error} [error]\n   * @param {SpreadLink} [spreadLink]\n   */\n  \n  /**\n   * Optional callback.\n   *\n   * @callback GraphSpreading~unspreadToCallback\n   */\n  \n  /**\n   * Spread all spread links from all available paths to this id.\n   * \n   * @param {string} id\n   * @param {Object} [context]\n   * @param {GraphSpreading~spreadToHandler} [handler]\n   * @param {GraphSpreading~spreadToCallback} [callback]\n   */\n   \n  spreadTo(id, context, handler, callback) {\n    this.each(this.pathGraphs, (pathGraph, nextPathGraph) => {\n      this.each(pathGraph.toFields, (toField, nextToField) => {\n        pathGraph.fetch({\n          [toField]: id\n        }, undefined, (error, pathLinks) => {\n          this.each(pathLinks, (pathLink, nextPathLink) => {\n            this.spreadByPathLink(pathGraph, pathLink, context, handler, nextPathLink);\n          }, function(error) {\n            nextToField();\n          });\n        });\n      }, nextPathGraph);\n    }, () => {\n      if (callback) callback();\n    });\n  }\n  \n  /**\n   * Optional handler. Fires after each processed spread link.\n   * Id can be empty if the `this.spreadGraph._spreadingHandler` banned spreading.\n   * \n   * @callback GraphSpreading~spreadToHandler\n   * @param {Error} [error]\n   * @param {string} [newSpreadLinkId]\n   * @param {SpreadLink} [prevSpreadLink]\n   * @param {PathGraph} [pathGraph]\n   * @param {PathLink} [pathLink]\n   */\n  \n  /**\n   * Optional callback.\n   *\n   * @callback GraphSpreading~spreadToCallback\n   */\n}\n\nexport { GraphSpreading };"]}